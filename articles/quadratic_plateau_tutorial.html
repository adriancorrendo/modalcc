<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Quadratic-plateau response • soiltestcorr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Abel-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quadratic-plateau response">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">soiltestcorr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/Introduction_to_soiltestcorr.html"><span class="fa fa-magic"></span> Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-gears"></span> Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-paperclip"></span> Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/bootstrapping_tutorial.html">Bootstrapping</a></li>
    <li><a class="dropdown-item" href="../articles/mod_alcc_tutorial.html">Modified ALCC</a></li>
    <li><a class="dropdown-item" href="../articles/cate_nelson_1965_tutorial.html">Cate &amp; Nelson (1965)</a></li>
    <li><a class="dropdown-item" href="../articles/cate_nelson_1971_tutorial.html">Cate &amp; Nelson (1971)</a></li>
    <li><a class="dropdown-item" href="../articles/linear_plateau_tutorial.html">Linear-plateau</a></li>
    <li><a class="dropdown-item" href="../articles/quadratic_plateau_tutorial.html">Quadratic-plateau</a></li>
    <li><a class="dropdown-item" href="../articles/mitscherlich_tutorial.html">Mistcherlich</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-plus"></span> More</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-more">
<li><a class="dropdown-item" href="../articles/SoftwareX_publication.html">SoftwareX publication</a></li>
    <li><a class="dropdown-item" href="../articles/Shinyapp.html">Shinyapp</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adriancorrendo/soiltestcorr/"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://adriancorrendo.github.io/"><span class="fa fa-user"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Quadratic-plateau response</h1>
                        <h4 data-toc-skip class="author">Adrian Correndo
&amp; Austin Pearce</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/adriancorrendo/soiltestcorr/blob/v2.2.1/vignettes/quadratic_plateau_tutorial.Rmd" class="external-link"><code>vignettes/quadratic_plateau_tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>quadratic_plateau_tutorial.Rmd</code></div>
    </div>

    
    
<p><img src="../reference/figures/soiltestcorr_logo.png" align="right" height="200" style="float:right; height:200px;"></p>
<div class="section level3">
<h3 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h3>
<p>This tutorial demonstrates the <code><a href="../reference/quadratic_plateau.html">quadratic_plateau()</a></code>
function for fitting a continuous response model and estimating a
critical soil test value (CSTV). This function fits a segmented
regression model that follows two phases: a positive curvilinear
response followed by a flat plateau phase. The join point is often
interpreted as the CSTV. See Bullock and Bullock (1994) for
example.<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mi>x</mi><mo>&lt;</mo><mi>j</mi><mo>,</mo><mspace width="0.222em"></mspace><mi>y</mi><mo>=</mo><mi>a</mi><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi><msup><mi>x</mi><mn>2</mn></msup></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mi>x</mi><mo>&gt;</mo><mi>j</mi><mo>,</mo><mspace width="0.222em"></mspace><mi>y</mi><mo>=</mo><mi>a</mi><mo>+</mo><mi>b</mi><mi>j</mi><mo>+</mo><mi>c</mi><msup><mi>j</mi><mn>2</mn></msup></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">
\begin{cases}
x &lt; j,\ y = a + bx + cx^2 \\
x &gt; j,\ y = a + bj + cj^2
\end{cases}
</annotation></semantics></math></p>
<p>where<br><code>y</code> represents the fitted crop relative yield<br><code>x</code> the soil test value<br><code>a</code> the intercept (<code>ry</code> when <code>stv</code> =
0)<br><code>b</code> the linear slope (as the change in ry per unit of soil
nutrient supply or nutrient added)<br><code>c</code> the quadratic coefficient (giving the curve shape)<br><code>j</code> the join point when the plateau phase starts (i.e., the
CSTV).</p>
<p>This model is slightly more complex than the linear-plateau, but the
curvature of the response is argued to be more biologically reasonably
and economical useful. The <code><a href="../reference/quadratic_plateau.html">quadratic_plateau()</a></code> function
works automatically with self-starting initial values to facilitate the
model convergence.</p>
<p>Disadvantages are that:</p>
<ul>
<li>the default CSTV confidence interval (based on symmetric Wald’s
intervals) is generally unreliable. We recommend the user try the
<code><a href="../reference/quadratic_plateau.html">boot_quadratic_plateau()</a></code> function for a reliable confidence
interval estimation of parameters via bootstrapping (resampling with
replacement).</li>
</ul>
</div>
<div class="section level3">
<h3 id="general-instructions">General Instructions<a class="anchor" aria-label="anchor" href="#general-instructions"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Load your dataframe with soil test value and relative yield
data.</p></li>
<li>
<p>Specify the following arguments into the function
<code><a href="../reference/quadratic_plateau.html">quadratic_plateau()</a></code>:</p>
<ol style="list-style-type: decimal">
<li><p><code>data</code> (optional)</p></li>
<li><p><code>stv</code> (soil test value)</p></li>
<li><p><code>ry</code> (relative yield) columns or vectors</p></li>
<li><p><code>target</code> (optional) for calculating the soil test
value at some RY level along the slope segment.</p></li>
<li><p><code>tidy</code> <code>TRUE</code> (produces a data.frame with
results) or <code>FALSE</code> (store results as list),</p></li>
<li><p><code>plot</code> <code>TRUE</code> (produces a ggplot as main
output) or <code>FALSE</code> (no plot, only results as
data.frame),</p></li>
<li><p><code>resid</code> <code>TRUE</code> (produces plots with
residuals analysis) or <code>FALSE</code> (no plot)</p></li>
</ol>
</li>
<li><p>Run and check results.</p></li>
<li><p>Check residuals plot, and warnings related to potential
limitations of this model.</p></li>
<li><p>Adjust curve plots as desired with additional
<code>ggplot2</code> functions.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="tutorial">Tutorial<a class="anchor" aria-label="anchor" href="#tutorial"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://adriancorrendo.github.io/soiltestcorr/">soiltestcorr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Registered S3 methods overwritten by 'ggpp':</span></span>
<span><span class="co">#&gt;   method                  from   </span></span>
<span><span class="co">#&gt;   heightDetails.titleGrob ggplot2</span></span>
<span><span class="co">#&gt;   widthDetails.titleGrob  ggplot2</span></span></code></pre></div>
<p>Suggested packages</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install if needed </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># Plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># Data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span> <span class="co"># Data wrangling</span></span>
<span><span class="co"># library(utils) # Data wrangling</span></span>
<span><span class="co"># library(data.table) # Mapping</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span> <span class="co"># Mapping</span></span></code></pre></div>
<p>This is a basic example using three different datasets:</p>
<div class="section level3">
<h3 id="load-dataset">Load dataset<a class="anchor" aria-label="anchor" href="#load-dataset"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Native fake dataset from soiltestcorr package</span></span>
<span><span class="va">corr_df</span> <span class="op">&lt;-</span> <span class="fu">soiltestcorr</span><span class="fu">::</span><span class="va"><a href="../reference/data_test.html">data_test</a></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fit-quadratic_plateau">Fit quadratic_plateau()<a class="anchor" aria-label="anchor" href="#fit-quadratic_plateau"></a>
</h2>
<div class="section level3">
<h3 id="individual-fits">1. Individual fits<a class="anchor" aria-label="anchor" href="#individual-fits"></a>
</h3>
<div class="section level4">
<h4 id="tidy-true-default">1.1. <code>tidy</code> = TRUE (default)<a class="anchor" aria-label="anchor" href="#tidy-true-default"></a>
</h4>
<p>It returns a tidy data frame (more organized results)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/quadratic_plateau.html">quadratic_plateau</a></span><span class="op">(</span><span class="va">corr_df</span>, <span class="va">STV</span>, <span class="va">RY</span>, tidy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 17</span></span></span>
<span><span class="co">#&gt;   intercept slope quadratic equation       plateau  CSTV lowerCL upperCL CI_type</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      44.1  2.86   -<span style="color: #BB0000;">0.039</span><span style="color: #BB0000; text-decoration: underline;">2</span> 44.1 + 2.86x …    96.4  36.5    29.7    43.4 Wald C…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: target &lt;dbl&gt;, STVt &lt;dbl&gt;, AIC &lt;dbl&gt;, AICc &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   BIC &lt;dbl&gt;, R2 &lt;dbl&gt;, RMSE &lt;dbl&gt;, pvalue &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="tidy-false">1.2. <code>tidy</code> = FALSE<a class="anchor" aria-label="anchor" href="#tidy-false"></a>
</h4>
<p>It returns a LIST (may be more efficient for multiple fits at
once)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/quadratic_plateau.html">quadratic_plateau</a></span><span class="op">(</span><span class="va">corr_df</span>, <span class="va">STV</span>, <span class="va">RY</span>, tidy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $intercept</span></span>
<span><span class="co">#&gt; [1] 44.14905</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $slope</span></span>
<span><span class="co">#&gt; [1] 2.862649</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $quadratic</span></span>
<span><span class="co">#&gt; [1] -0.03919089</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $equation</span></span>
<span><span class="co">#&gt; [1] "44.1 + 2.86x + -0.04x^2 when x &lt; 36.5"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $plateau</span></span>
<span><span class="co">#&gt; [1] 96.42367</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CSTV</span></span>
<span><span class="co">#&gt; [1] 36.52186</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lowerCL</span></span>
<span><span class="co">#&gt; [1] 29.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $upperCL</span></span>
<span><span class="co">#&gt; [1] 43.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CI_type</span></span>
<span><span class="co">#&gt; [1] "Wald Conf. Interval"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $target</span></span>
<span><span class="co">#&gt; [1] 96.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $STVt</span></span>
<span><span class="co">#&gt; [1] 36.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AIC</span></span>
<span><span class="co">#&gt; [1] 1023.43</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AICc</span></span>
<span><span class="co">#&gt; [1] 1023.73</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $BIC</span></span>
<span><span class="co">#&gt; [1] 1035.11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $R2</span></span>
<span><span class="co">#&gt; [1] 0.53</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $RMSE</span></span>
<span><span class="co">#&gt; [1] 9.85</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $pvalue</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="alternative-using-the-vectors">1.3. Alternative using the vectors<a class="anchor" aria-label="anchor" href="#alternative-using-the-vectors"></a>
</h4>
<p>You can use the <code>stv</code> and <code>ry</code> vectors from the
data frame using the <code>$</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fit_vectors_tidy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadratic_plateau.html">quadratic_plateau</a></span><span class="op">(</span>stv <span class="op">=</span> <span class="va">corr_df</span><span class="op">$</span><span class="va">STV</span>, ry <span class="op">=</span> <span class="va">corr_df</span><span class="op">$</span><span class="va">RY</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_vectors_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadratic_plateau.html">quadratic_plateau</a></span><span class="op">(</span>stv <span class="op">=</span> <span class="va">corr_df</span><span class="op">$</span><span class="va">STV</span>, ry <span class="op">=</span> <span class="va">corr_df</span><span class="op">$</span><span class="va">RY</span>, tidy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="multiple-fits-at-once">2. Multiple fits at once<a class="anchor" aria-label="anchor" href="#multiple-fits-at-once"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example 1. Fake dataset manually created</span></span>
<span><span class="va">data_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"RY"</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">65</span>,<span class="fl">80</span>,<span class="fl">85</span>,<span class="fl">88</span>,<span class="fl">90</span>,<span class="fl">94</span>,<span class="fl">93</span>,<span class="fl">96</span>,<span class="fl">97</span>,<span class="fl">95</span>,<span class="fl">98</span>,<span class="fl">100</span>,<span class="fl">99</span>,<span class="fl">99</span>,<span class="fl">100</span><span class="op">)</span>,</span>
<span>                     <span class="st">"STV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">13</span>,<span class="fl">14</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Example 2. Native fake dataset from soiltestcorr package</span></span>
<span><span class="va">data_2</span> <span class="op">&lt;-</span> <span class="fu">soiltestcorr</span><span class="fu">::</span><span class="va"><a href="../reference/data_test.html">data_test</a></span></span>
<span></span>
<span></span>
<span><span class="co"># Example 3. Native dataset from soiltestcorr package, Freitas et al.  (1966), used by Cate &amp; Nelson (1971)</span></span>
<span><span class="va">data_3</span> <span class="op">&lt;-</span> <span class="fu">soiltestcorr</span><span class="fu">::</span><span class="va"><a href="../reference/freitas1966.html">freitas1966</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>STV <span class="op">=</span> <span class="va">STK</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">data_1</span>, <span class="va">data_2</span>, <span class="va">data_3</span>, .id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span></code></pre></div>
<p>Note: the <code>stv</code> column needs to have the same name for all
datasets if binding rows.</p>
<div class="section level4">
<h4 id="using-map">2.1. Using <code>map()</code><a class="anchor" aria-label="anchor" href="#using-map"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Run multiple examples at once with purrr::map()</span></span>
<span><span class="va">data.all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"STV"</span>, <span class="st">"RY"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span> <span class="fu"><a href="../reference/quadratic_plateau.html">quadratic_plateau</a></span><span class="op">(</span>stv <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">STV</span>, ry <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">RY</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 19</span></span></span>
<span><span class="co">#&gt;   id    data     intercept slope quadratic equation        plateau  CSTV lowerCL</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1     <span style="color: #949494;">&lt;tibble&gt;</span>      61.0  8.59   -<span style="color: #BB0000;">0.502</span>  61 + 8.59x + -…    97.7  8.56     6.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2     <span style="color: #949494;">&lt;tibble&gt;</span>      44.1  2.86   -<span style="color: #BB0000;">0.039</span><span style="color: #BB0000; text-decoration: underline;">2</span> 44.1 + 2.86x +…    96.4 36.5     29.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3     <span style="color: #949494;">&lt;tibble&gt;</span>      12.9  1.91   -<span style="color: #BB0000;">0.011</span><span style="color: #BB0000; text-decoration: underline;">1</span> 12.9 + 1.91x +…    95.3 86.2     45.5</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 10 more variables: upperCL &lt;dbl&gt;, CI_type &lt;chr&gt;, target &lt;dbl&gt;, STVt &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   AIC &lt;dbl&gt;, AICc &lt;dbl&gt;, BIC &lt;dbl&gt;, R2 &lt;dbl&gt;, RMSE &lt;dbl&gt;, pvalue &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="using-group_modify">2.2. Using <code>group_modify()</code><a class="anchor" aria-label="anchor" href="#using-group_modify"></a>
</h4>
<p>Alternatively, with <code>group_modify</code>, nested data is not
required. However, it still requires a grouping variable (in this case,
<code>id</code>) to identify each dataset. <code><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_map()</a></code> may
also be used, though <code><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind()</a></code> is required to return a
tidy data frame of the model results instead of a list.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data.all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_modify</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="../reference/quadratic_plateau.html">quadratic_plateau</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span>, <span class="va">STV</span>, <span class="va">RY</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 18</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   id [3]</span></span></span>
<span><span class="co">#&gt;   id    intercept slope quadratic equation plateau  CSTV lowerCL upperCL CI_type</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1          61.0  8.59   -<span style="color: #BB0000;">0.502</span>  61 + 8.…    97.7  8.56     6.6    10.5 Wald C…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2          44.1  2.86   -<span style="color: #BB0000;">0.039</span><span style="color: #BB0000; text-decoration: underline;">2</span> 44.1 + …    96.4 36.5     29.7    43.4 Wald C…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3          12.9  1.91   -<span style="color: #BB0000;">0.011</span><span style="color: #BB0000; text-decoration: underline;">1</span> 12.9 + …    95.3 86.2     45.5   127.  Wald C…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: target &lt;dbl&gt;, STVt &lt;dbl&gt;, AIC &lt;dbl&gt;, AICc &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   BIC &lt;dbl&gt;, R2 &lt;dbl&gt;, RMSE &lt;dbl&gt;, pvalue &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="bootstrapping">3. Bootstrapping<a class="anchor" aria-label="anchor" href="#bootstrapping"></a>
</h3>
<p>Bootstrapping is a suitable method for obtaining confidence intervals
for parameters or derived quantities. Bootstrapping is a resampling
technique (with replacement) that draws samples from the original data
with the same size. If you have groups within your data, you can specify
grouping variables as arguments in order to maintain, within each
resample, the same proportion of observations than in the original
dataset.</p>
<p>This function returns a table with as many rows as the resampling
size (n) containing the results for each resample.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot_qp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadratic_plateau.html">boot_quadratic_plateau</a></span><span class="op">(</span><span class="va">corr_df</span>, <span class="va">STV</span>, <span class="va">RY</span>, n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># only 500 for sake of speed</span></span>
<span></span>
<span><span class="va">boot_qp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 14</span></span></span>
<span><span class="co">#&gt;   boot_id intercept slope quadratic plateau  CSTV target  STVt   AIC  AICc   BIC</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       1      57.0  1.87   -<span style="color: #BB0000;">0.021</span><span style="color: #BB0000; text-decoration: underline;">9</span>    97.0  42.7   97    42.7 <span style="text-decoration: underline;">1</span>023. <span style="text-decoration: underline;">1</span>023. <span style="text-decoration: underline;">1</span>034.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       2      53.9  1.99   -<span style="color: #BB0000;">0.022</span><span style="color: #BB0000; text-decoration: underline;">9</span>    97.1  43.4   97.1  43.4 <span style="text-decoration: underline;">1</span>019. <span style="text-decoration: underline;">1</span>019. <span style="text-decoration: underline;">1</span>030.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>       3      47.4  2.79   -<span style="color: #BB0000;">0.039</span><span style="color: #BB0000; text-decoration: underline;">5</span>    96.7  35.3   96.7  35.3 <span style="text-decoration: underline;">1</span>027. <span style="text-decoration: underline;">1</span>027. <span style="text-decoration: underline;">1</span>038.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>       4      30.1  4.23   -<span style="color: #BB0000;">0.067</span><span style="color: #BB0000; text-decoration: underline;">9</span>    96.1  31.2   96.1  31.2 <span style="text-decoration: underline;">1</span>047. <span style="text-decoration: underline;">1</span>048. <span style="text-decoration: underline;">1</span>059.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>       5      47.8  2.71   -<span style="color: #BB0000;">0.037</span><span style="color: #BB0000; text-decoration: underline;">8</span>    96.4  35.9   96.4  35.9 <span style="text-decoration: underline;">1</span>028. <span style="text-decoration: underline;">1</span>028. <span style="text-decoration: underline;">1</span>039.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: R2 &lt;dbl&gt;, RMSE &lt;dbl&gt;, pvalue &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="co"># CSTV Confidence Interval</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">boot_qp</span><span class="op">$</span><span class="va">CSTV</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     2.5%      50%    97.5% </span></span>
<span><span class="co">#&gt; 27.76841 36.71537 50.74843</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">boot_qp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CSTV</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey25"</span>, fill <span class="op">=</span> <span class="st">"#9de0bf"</span>, bins <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="quadratic_plateau_tutorial_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="plots">4. Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h3>
<div class="section level4">
<h4 id="correlation-curve">4.1. Correlation Curve<a class="anchor" aria-label="anchor" href="#correlation-curve"></a>
</h4>
<p>We can generate a ggplot with the same
<code><a href="../reference/quadratic_plateau.html">quadratic_plateau()</a></code> function.</p>
<p>We just need to specify the argument <code>plot = TRUE</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_3</span> <span class="op">&lt;-</span> <span class="fu">soiltestcorr</span><span class="fu">::</span><span class="va"><a href="../reference/freitas1966.html">freitas1966</a></span></span>
<span></span>
<span><span class="va">plot_qp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadratic_plateau.html">quadratic_plateau</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_3</span>, <span class="va">STK</span>, <span class="va">RY</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_qp</span></span></code></pre></div>
<p><img src="quadratic_plateau_tutorial_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="fine-tune-the-plots">4.2. Fine-tune the plots<a class="anchor" aria-label="anchor" href="#fine-tune-the-plots"></a>
</h4>
<p>As ggplot object, plots can be adjusted in several ways, such as
modifying titles and axis scales.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_qp</span> <span class="op">+</span></span>
<span>  <span class="co"># Main title</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"My own plot title"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># Axis titles</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Soil Test K (ppm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cotton RY(%)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Axis scales</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">220</span><span class="op">)</span>,</span>
<span>                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">220</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># Axis limits</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">110</span><span class="op">)</span>,</span>
<span>                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">110</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="quadratic_plateau_tutorial_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="residuals">4.3. Residuals<a class="anchor" aria-label="anchor" href="#residuals"></a>
</h4>
<p>Set the argument <code>resid = TRUE</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Residuals plot</span></span>
<span><span class="fu"><a href="../reference/quadratic_plateau.html">quadratic_plateau</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_3</span>, <span class="va">STK</span>, <span class="va">RY</span>, resid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="quadratic_plateau_tutorial_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 17</span></span></span>
<span><span class="co">#&gt;   intercept slope quadratic equation       plateau  CSTV lowerCL upperCL CI_type</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      12.9  1.91   -<span style="color: #BB0000;">0.011</span><span style="color: #BB0000; text-decoration: underline;">1</span> 12.9 + 1.91x …    95.3  86.2    45.5    127. Wald C…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: target &lt;dbl&gt;, STVt &lt;dbl&gt;, AIC &lt;dbl&gt;, AICc &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   BIC &lt;dbl&gt;, R2 &lt;dbl&gt;, RMSE &lt;dbl&gt;, pvalue &lt;dbl&gt;</span></span></span></code></pre>
<div class="section level5">
<h5 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h5>
<p><em>Bullock, D.G. and Bullock, D.S. (1994), Quadratic and
Quadratic-Plus-Plateau Models for Predicting Optimal Nitrogen Rate of
Corn: A Comparison. Agron. J., 86: 191-195.
10.2134/agronj1994.00021962008600010033x</em></p>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adrian A. Correndo, Austin Pearce, Deanna Osmond, Ignacio A. Ciampitti.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
